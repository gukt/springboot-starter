server:
  port: 8080
  servlet:
    context-path: /
  compression:
    enabled: true
    mime-types: application/json,application/xml,text/html,text/plain,text/xml,text/css,application/javascript
    min-response-size: 2048

spring:
  application:
    name: springboot-starter

  profiles:
    active: dev

  # 数据库配置
  datasource:
    url: jdbc:mysql://${DB_HOST:localhost}:${DB_PORT:3306}/${DB_NAME:springboot_starter_dev}?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true
    username: ${DB_USERNAME:root}
    password: ${DB_PASSWORD:1234+asdf}
    driver-class-name: com.mysql.cj.jdbc.Driver
    hikari:
      # 连接池配置
      maximum-pool-size: 20
      minimum-idle: 5
      connection-timeout: 30000          # 连接超时时间：30秒
      idle-timeout: 600000               # 空闲连接超时时间：10分钟
      max-lifetime: 1800000              # 连接最大生命周期：30分钟
      leak-detection-threshold: 60000    # 连接泄漏检测阈值：60秒
      connection-test-query: SELECT 1    # 连接测试查询
      pool-name: SpringBootHikariCP       # 连接池名称

  # JPA 配置
  jpa:
    hibernate:
      ddl-auto: validate                  # 使用 Flyway，设置为 validate
    show-sql: false                       # 生产环境不显示 SQL
    properties:
      hibernate:
        dialect: org.hibernate.dialect.MySQLDialect
        format_sql: true                   # 格式化 SQL
        use_sql_comments: true             # 使用 SQL 注释
        jdbc.batch_size: 25                # JDBC 批处理大小
        order_inserts: true                # 优化批量插入
        order_updates: true                # 优化批量更新
        jdbc.fetch_size: 100              # JDBC 获取大小
        generate_statistics: false         # 不生成统计信息
    open-in-view: false                  # 关闭 Open Session in View

  # Flyway 配置
  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true
    validate-on-migrate: true
    clean-disabled: true
    table: flyway_schema_history
    sql-migration-separator: ;;
    sql-migration-prefixes: V
    sql-migration-suffixes: .sql
    encoding: UTF-8
    placeholder-replacement: true
    placeholders:
      # 占位符配置
      db_name: ${DB_NAME:springboot_starter_dev}

  # Redis 配置
  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}
      password: ${REDIS_PASSWORD:}
      database: ${REDIS_DATABASE:0}
      timeout: 10000                    # 连接超时时间：10秒
      lettuce:
        pool:
          max-active: 20                 # 最大活跃连接数
          max-idle: 10                   # 最大空闲连接数
          min-idle: 5                    # 最小空闲连接数
          max-wait: 3000                 # 最大等待时间：3秒
          time-between-eviction-runs: 60000  # 空闲连接回收间隔：60秒

  # 缓存配置
  cache:
    type: caffeine                     # 默认使用 Caffeine
    cache-names: user, role, permission, api_response
    caffeine:
      spec: maximumSize=1000,expireAfterWrite=3600s  # Caffeine 缓存配置

  # JSON 配置
  jackson:
    date-format: yyyy-MM-dd HH:mm:ss
    time-zone: Asia/Shanghai
    serialization:
      write-dates-as-timestamps: false
      fail-on-empty-beans: false
    deserialization:
      fail-on-unknown-properties: false
    default-property-inclusion: non_null

  # 文件上传配置
  servlet:
    multipart:
      enabled: true
      max-file-size: 10MB
      max-request-size: 10MB
      file-size-threshold: 0

  # 国际化配置
  messages:
    basename: i18n/messages
    encoding: UTF-8
    fallback-to-system-locale: false

# JWT 配置
jwt:
  secret: ${JWT_SECRET:mySecretKey123456789}
  expiration: 86400000                     # 24小时
  refresh-expiration: 604800000           # 7天
  header: Authorization
  prefix: Bearer

# Langfuse 配置
langfuse:
  enabled: ${LANGFUSE_ENABLED:false}       # 是否启用 Langfuse 追踪
  host: ${LANGFUSE_HOST:https://cloud.langfuse.com}  # Langfuse 服务器地址
  api-key: ${LANGFUSE_API_KEY:}           # Langfuse API 密钥
  secret-key: ${LANGFUSE_SECRET_KEY:}     # Langfuse 密钥
  project: ${LANGFUSE_PROJECT:default}     # 项目名称
  user-id: ${LANGFUSE_USER_ID:system}     # 用户 ID
  session-id: ${LANGFUSE_SESSION_ID:}      # 会话 ID
  tags: ${LANGFUSE_TAGS:api}              # 标签
  # 追踪配置
  trace:
    enabled: ${LANGFUSE_TRACE_ENABLED:true}  # 是否启用请求追踪
    sample-rate: ${LANGFUSE_SAMPLE_RATE:1.0} # 采样率 (0.0-1.0)
    include-request-headers: ${LANGFUSE_INCLUDE_REQUEST_HEADERS:true}  # 是否包含请求头
    include-response-headers: ${LANGFUSE_INCLUDE_RESPONSE_HEADERS:true} # 是否包含响应头
    include-request-body: ${LANGFUSE_INCLUDE_REQUEST_BODY:true}         # 是否包含请求体
    include-response-body: ${LANGFUSE_INCLUDE_RESPONSE_BODY:true}        # 是否包含响应体
    max-body-size: ${LANGFUSE_MAX_BODY_SIZE:1024} # 最大记录 body 大小 (KB)

# Swagger 配置
springdoc:
  api-docs:
    path: /api-docs
    enabled: true
  swagger-ui:
    path: /swagger-ui.html
    enabled: true
    try-it-out-enabled: true
    operations-sorter: method
    tags-sorter: alpha
    doc-expansion: none
    filter: true
    display-request-duration: true
  show-actuator: false
  default-produces-media-type: application/json
  default-consumes-media-type: application/json

# 日志配置
logging:
  level:
    root: INFO
    com.example.demo: DEBUG
    org.springframework.web: DEBUG
    org.springframework.security: DEBUG
    org.hibernate.SQL: DEBUG
    org.hibernate.type.descriptor.sql.BasicBinder: TRACE
    org.springframework.cache: DEBUG
    org.springframework.data.redis: DEBUG
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
  file:
    name: logs/springboot-starter.log
    max-size: 10MB
    max-history: 30
    total-size-cap: 1GB

# 管理端点配置
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,env,beans
      base-path: /actuator
  endpoint:
    health:
      show-details: when-authorized
      probes:
        enabled: true
    info:
      enabled: true
  metrics:
    export:
      prometheus:
        enabled: true
    tags:
      application: springboot-starter
    distribution:
      percentiles-histogram:
        http.server.requests: true
    web:
      server:
        request:
          autotime:
            enabled: true
            percentiles: 0.5,0.95,0.99

## 应用信息
#info:
#  app:
#    name: Spring Boot Starter
#    version: 1.0.0
#    description: Spring Boot 脚手架项目
#    encoding: UTF-8

## 自定义配置
#app:
#  security:
#    allow-paths: /api/auth/**,/swagger-ui/**,/api-docs/**,/actuator/**
#    cors:
#      allowed-origins: "*"
#      allowed-methods: GET,POST,PUT,DELETE,OPTIONS,HEAD
#      allowed-headers: "*"
#      allow-credentials: true
#      max-age: 3600
#  cache:
#    default-ttl: 3600                 # 默认缓存时间：1小时
#    user-ttl: 1800                    # 用户缓存时间：30分钟
#    api-ttl: 600                      # API 响应缓存时间：10分钟
#  pagination:
#    default-size: 20                  # 默认分页大小
#    max-size: 100                     # 最大分页大小
#  upload:
#    path: ${UPLOAD_PATH:./uploads}     # 文件上传路径
#    max-size: 10485760                 # 最大文件大小：10MB
#  file:
#    storage-type: local               # 文件存储类型：local,oss,minio
#    allowed-types: jpg,jpeg,png,gif,pdf,doc,docx,xls,xlsx,ppt,pptx,txt